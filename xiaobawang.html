<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    <meta name="x5-orientation" content="landscape">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <title>FC游戏在线玩 | 小霸王其乐无穷</title>
    <meta name="keywords" content="FC/NES模拟器，在线畅玩八十款任天堂红白机游戏，小霸王游戏机其乐无穷。支持魂斗罗/超级玛丽/忍者龙剑传等等任天堂红白机游戏。" />
    <meta name="description" content="非常适合在手机/电脑上在线游玩，近乎完美的还原任天堂FC/NES原版ROM游戏的视频和声音。" />
    <link href="css/jsnes.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="/static/favicon.ico">

    <style>
        /* 基本重置 */
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            /* 防止滚动 */
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            /* 深色背景 */
        }

        /* 主要布局 (移动端竖屏) */
        .main,
        .panel {
            display: flex;
            flex-direction: column;
            /* 关键：屏幕在上面，控制在下面 */
            height: 100vh;
            /* 完整的视口高度 */
            width: 100vw;
            /* 完整的视口宽度 */
            box-sizing: border-box;
            background: #1a1a1a;
        }

        /* 游戏屏幕区域 */
        .screen {
            flex-grow: 1;
            /* 屏幕占据所有可用空间 */
            position: relative;
            width: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        #emulator {
            width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* 模拟器生成的canvas也需要适配 */
        #emulator canvas {
            width: 100% !important;
            height: auto !important;
            object-fit: contain;
            image-rendering: pixelated;
            /* 保持像素感 */
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
        }

        /* 所有控制按钮的容器 (新添加的) */
        .all-controls {
            flex-shrink: 0;
            /* 不让控制区缩小 */
            display: flex;
            justify-content: space-between;
            /* D-pad在左, A/B在右 */
            align-items: center;
            padding: 15px 20px;
            padding-bottom: calc(15px + env(safe-area-inset-bottom)); /* 适配iPhone X等刘海屏 */
            background: #3a3a3a;
            width: 100%;
            box-sizing: border-box;
            gap: 10px;
            /* 元素间距 */
        }

        /* D-Pad 区域 */
        .controller-area {
            position: relative;
            width: 130px;
            /* 调整D-pad大小 */
            height: 130px;
        }

        #controls-rocker {
            /* 摇杆JS会控制这里 */
            width: 100% !important;
            height: 100% !important;
        }

        /* 隐藏原生的U/R/D/L按钮，因为nipplejs会接管 */
        .joydirection {
            display: none;
        }

        /* 功能键 (Start/Select) 区域 */
        .function {
            display: flex;
            flex-direction: column;
            /* 竖向堆叠 Start/Select */
            gap: 15px;
            align-items: center;
        }

        /* 所有按钮的通用样式 */
        .joybtn {
            background: #707070;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            padding: 10px 15px;
            text-align: center;
            box-shadow: 0 4px #444;
            cursor: pointer;
            -webkit-user-select: none; /* 防止触摸时选中文本 */
            user-select: none;
        }

        .joybtn:active {
            box-shadow: 0 2px #222;
            transform: translateY(2px);
        }

        /* Action (A/B) 区域 */
        .action-area {
            padding-right: 10px;
        }
        .action #controls-fire {
            display: flex;
            gap: 25px;
            /* A/B按钮间距 */
            align-items: center;
        }

        /* A/B按钮的特定样式 */
        .action .joybtn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            /* 圆形按钮 */
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px #444;
        }

        .action .a {
            background: #d9534f;
            /* 红色 A */
        }

        .action .b {
            background: #f0ad4e;
            /* 黄色 B */
        }

        /* 隐藏桌面版的元素 */
        .sign,
        .joy,
        .readme,
        a[href="index.html"] {
            display: none;
        }

        /* * 响应式：横屏
         */
        @media (orientation: landscape) {
            .panel {
                flex-direction: row;
                /* 关键：屏幕在左，控制在右 */
            }

            .screen {
                flex-grow: 1;
                /* 屏幕占据左侧 */
                height: 100%;
            }

            .all-controls {
                flex-direction: row; /* 横屏时还是左右布局 */
                justify-content: space-around;
                width: 320px; /* 给控制区固定宽度 */
                height: 100%;
                padding: 10px;
                flex-wrap: wrap; /* 允许换行 */
                align-content: space-around;
            }

            .controller-area {
                width: 140px;
                height: 140px;
            }

            .function {
                flex-direction: row;
                /* Start/Select 并排 */
                gap: 20px;
                width: 100%;
                justify-content: center;
                order: -1; /* 把Start/Select提到最上面 */
            }
            .action-area {
                padding-right: 0;
            }
            .action #controls-fire {
                flex-direction: column-reverse; /* A在B上面 */
                gap: 15px;
            }
        }
    </style>
    </head>

<body>
    <div class="main">
        <div class="panel">

            <div class="screen">
                <div id="emulator" align="center" style="width:100%;height:100%"></div>
            </div>

            <div class="all-controls">

                <div class="controller-area">
                    <div id="controls-direction">
                        <div id="controls-rocker"></div>
                        <button role="BUTTON_UP" class="up joydirection" id="joystick_btn_up">U</button>
                        <button role="BUTTON_RIGHT" class="right joydirection" id="joystick_btn_right">R</button>
                        <button role="BUTTON_DOWN" class="down joydirection" id="joystick_btn_down">D</button>
                        <button role="BUTTON_LEFT" class="left joydirection" id="joystick_btn_left">L</button>
                    </div>
                </div>

                <div class="function">
                    <button class="controls-center-select joybtn" id="joystick_btn_select" role="BUTTON_SELECT">退出</button>
                    <button class="controls-center-start joybtn" id="joystick_btn_start" role="BUTTON_START">开始</button>
                </div>

                <div class="action-area">
                    <div class="action">
                        <div id="controls-fire">
                            <button class="b joybtn" role="BUTTON_B" id="joystick_btn_B">B</button>
                            <button class="a joybtn" role="BUTTON_A" id="joystick_btn_A">A</button>
                        </div>
                    </div>
                </div>

            </div>

            <div class="joy" style="display: none;">I</div>
            <div style="display: none;"><a href="https://github.com/lucaschungzsj/fcgame?tab=readme-ov-file#按键说明" tppabs="" target="_blank" class="readme">按键说明</a></div>
            <a href="index.html" style="display: none;">返回空投日历</a>
            <div class="sign" style="display: none;">FAMILY <br> COMPUTER</div>
        </div>
    </div>

    <script src="lib/jquery-1.4.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/dynamicaudio-min.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/nes.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/utils.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/cpu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/keyboard.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/mappers.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/papu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/ppu.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/rom.js" type="text/javascript" charset="utf-8"></script>
    <script src="source/ui.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/debug.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/nipplejs.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/joystick.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/jweixin-1.6.0.js" type="text/javascript" charset="utf-8"></script>

    <script type="text/javascript" charset="utf-8">
        var nes;
        $(function () {
            nes = new JSNES({
                'ui': $('#emulator').JSNESUI({
                    "经典热门": [
                        ['沙罗曼蛇 (U) Life Force [!]', 'roms/Life Force [!].nes'],
                        ['超级马里奥1 (W) Super Mario Bros. [!]', 'roms/(W) Super Mario Bros. [!].nes'],
                        ['坦克 (J) Battle City [!]', 'roms/(J) Battle City.nes'],
                        ['魂斗罗1 (U) 30S [!]', 'roms/Contra1(U)30S.nes'],
                        ['赤影战士 Kage [!]', 'roms/Kage.nes'],
                        ['脱狱 Cross Fire (J)', 'roms/Cross Fire (J).nes'],
                        ['双截龙2 Double Dragon2 [!]', 'roms/Double Dragon2.nes'],
                        ['塞尔达传说2：林克的冒险 [!] Zelda II - The Adventure of Link(U) [!]', 'roms/Zelda II - The Adventure of Link (U).nes'],
                        ['冒险岛1 (J) Adventure Island [!]', 'roms/(J) Takahashi Meijin no Bouken Shima [!].nes'],
                        ['1943 (U) 1943 - The Battle of Midway [!]', 'roms/1943.nes'],
                        ['火箭车 (J) Road Fighter [!]', 'roms/(J) Road Fighter [!].nes'],
                        ['越野机车 (JU) Excitebike [!]', 'roms/(JU) Excitebike [!].nes'],
                        ['功夫 (J) (V1.2) Yie Ar Kung-Fu [!]', 'roms/(J) (V1.2) Yie Ar Kung-Fu [!].nes'],
                        ['淘金者(汉化) [!]', 'roms/TaoJinZhe.nes'],
                        ['俄罗斯方块 (U) Tetris 2 [!]', 'roms/Tetris 2 (U) [!].nes'],
                        ['中国象棋 [!]', 'roms/Zhong Guo Xiang Qi.nes'],
                        ['五子棋 (5) 日版 [!]', 'roms/5.nes'],
                        ['炸弹人1 [!] (J) Bomberman [!]', 'roms/(J) Bomberman [!].nes'],
                    ],
                    "超级玛丽": [
                        ['超级马里奥1 (W) Super Mario Bros. [!]', 'roms/(W) Super Mario Bros. [!].nes'],
                        ['超级马里奥2 (W) Super Mario Bros. 3 (U)', 'roms/Super Mario Bros. 3 (U) (PRG1) [!].nes'],
                        ['马里奥拆屋工 (W) Wrecking Crew', 'roms/(W) Wrecking Crew [!].nes'],
                        ['马里奥医生 (JU) Dr. Mario', 'roms/Dr. Mario (JU).nes'],
                    ],
                    "坦克大战": [
                        ['坦克大战 (J) Battle City [!]', 'roms/(J) Battle City.nes'],
                        ['导弹坦克 (Ch) Missile Tank', 'roms/(Ch) Missile Tank.nes'],
                        ['坦克1990 (Ch) Tank 1990', 'roms/(Ch) Tank 1990.nes'],
                    ],
                    "魂斗罗": [
                        ['魂斗罗1 (U) 30S [!]', 'roms/Contra1(U)30S.nes'],
                        ['魂斗罗1 (U) 30', 'roms/Contra1(U)30.nes'],
                        ['魂斗罗1 (U) 30F', 'roms/Contra1(U)30F.nes'],
                        ['魂斗罗1 (U) 30L', 'roms/Contra1(U)30L.nes'],
                        ['魂斗罗1 (U) 30M', 'roms/Contra1(U)30M.nes'],
                        ['魂斗罗1 (U) S [!]', 'roms/Contra1(U)S.nes'],
                        ['魂斗罗1 (U) F', 'roms/Contra1(U)F.nes'],
                        ['魂斗罗1 (U) L', 'roms/Contra1(U)L.nes'],
                        ['魂斗罗1 (U) M', 'roms/Contra1(U)M.nes'],
                    ],
                    "双截龙": [
                        ['双截龙2 Double Dragon2 [!]', 'roms/Double Dragon2.nes'],
                        ['双截龙1 Double Dragon1', 'roms/Double Dragon1.nes'],
                        ['双截龙3 Double Dragon3', 'roms/Double Dragon3.nes'],
                        ['双截龙4 Double Dragon4', 'roms/Double Dragon4.nes'],
                    ],
                    "淘金者": [
                        ['淘金者(汉化) [!]', 'roms/TaoJinZhe.nes'],
                        ['淘金者(J)', 'roms/Championship Lode Runner (J).nes'],
                    ],
                    "俄罗斯方块": [
                        ['俄罗斯方块2 (U) Tetris 2 [!]', 'roms/Tetris 2 (U) [!].nes'],
                        ['俄罗斯方块 LJ65', 'roms/lj65.nes'],
                        ['俄罗斯方块 Tetris(U)', 'roms/Tetris (U) [!].nes'],
                        ['俄罗斯方块 (Tengen) Tetris [!]', 'roms/(Tengen) Tetris [!].nes'],
                    ],
                    "飞机类": [
                        ['沙罗曼蛇 (U) Life Force [!]', 'roms/Life Force [!].nes'],
                        ['1943 (U) 1943 - The Battle of Midway [!]', 'roms/1943.nes'],
                        ['兵蜂1 (J) TwinBee [!]', 'roms/(J) TwinBee [!].nes'],
                    ],
                    "赛车类": [
                        ['火箭车 (J) Road Fighter [!]', 'roms/(J) Road Fighter [!].nes'],
                        ['越野机车 (JU) Excitebike [!]', 'roms/(JU) Excitebike [!].nes'],
                        ['F1赛车 (J) F-1 Race', 'roms/(J) F-1 Race [!].nes'],
                        ['摩托车大赛 (JU) (PRG0) Mach Rider', 'roms/(JU) (PRG0) Mach Rider [!].nes'],
                    ],
                    "运动类": [
                        ['网球Tennis(JU)', 'roms/Tennis (JU) [!].nes'],
                        ['高尔夫 Golf (JU)', 'roms/Golf (JU).nes'],
                    ],
                    "棋牌类": [
                        ['中国象棋 [!]', 'roms/Zhong Guo Xiang Qi.nes'],
                        ['五子棋 (5) 日版 [!]', 'roms/5.nes'],
                        ['Concentration Room', 'roms/croom.nes'],
                        ['AV麻雀俱乐部 (Hacker) AV Mahjongg', 'roms/(Hacker) AV Mahjongg.nes'],
                    ],
                    "其他": [
                        ['马戏团 (J) Circus Charlie', 'roms/(J) Circus Charlie [!].nes'],
                        ['敲冰块 (J) Ice Climber', 'roms/(J) Ice Climber.nes'],
                        ['纽约大拳猫 (JP)', 'roms/RockinCats.nes'],
                        ['撞球咖啡馆 Shufflepuck Cafe', 'roms/Shufflepuck Cafe.nes'],
                        ['泡泡龙 Bubble Bobble (U)', 'roms/Bubble Bobble (U).nes'],
                        ['地底探险1 (J) Spelunker', 'roms/(J) Spelunker [!].nes'],
                        ['快乐猫 (J) Mappy', 'roms/(J) Mappy [!].nes'],
                        ['成龙踢馆1 (J) Spartan X', 'roms/(J) Spartan X [!].nes'],
                        ['猪小弟 (J) Pooyan', 'roms/(J) Pooyan.nes'],
                        ['打砖块1 (J) Arkanoid', 'roms/(J) Arkanoid [!].nes'],
                    ],
                    "不可用": [
                        ['小蜜蜂 (J) Galaxian', 'roms/(J) Galaxian [!].nes'],
                        ['赤色要塞 (KC) Jackal [!]', 'roms/Jackal.nes'],
                        ['花式撞球 (U) Side Pocket', 'roms/Side Pocket.nes'],
                        ['彩虹岛 (U) Rainbow Islands', 'roms/Rainbow Islands.nes'],
                        ['快打旋风 (U) Mighty Final Fight [!]', 'roms/Mighty Final Fight.nes'],
                        ['忍者龙剑传1 (PC10) Ninja Gaiden [!]', 'roms/Ninja_Gaiden1.nes'],
                        ['忍者龙剑传2 (PC10) Ninja Gaiden II [!]', 'roms/Ninja_Gaiden2.nes'],
                        ['忍者龙剑传3 (PC10) Ninja Gaiden III [!]', 'roms/Ninja_Gaiden3.nes'],
                        ['七宝奇谋1 (J) Goonies, The [!]', 'roms/(J) Goonies, The [!].nes'],
                        ['南极大冒险 (J) Antarctic Adventure', 'roms/(J) Antarctic Adventure [!].nes'],
                        ['叮当1 (J) Dig Dug', 'roms/(J) Dig Dug [!].nes'],
                        ['影之传说 (J) Kage no Densetsu [!]', 'roms/(J) Kage no Densetsu [!].nes'],
                    ],
                })
            });
        });
    </script>
    <script>
        function touchDwon(evt) {
            nes.keyboard.keyDown({
                keyCode: evt.keyCode
            });
        };

        function touchUp(evt) {
            nes.keyboard.keyUp({
                keyCode: evt.keyCode
            });
        };

        function select(val) {
            if (val.substring(0, 1) == "#") {
                return document.querySelector(val);
            } else {
                return document.getElementById(val);
            }
        }

        var joystick = new Joystick({
            el: select("controls-rocker"),
            mode: 'static',
            color: "#808080",
            size: 130, // 调整摇杆大小以匹配CSS
            isFourBtn: false,
            keyCodes: [87, 83, 65, 68],
            btn_down_fn: touchDwon,
            btn_up_fn: touchUp,
            relative: true,
        });
        joystick.init();
    </script>
    
    </body>

</html>
